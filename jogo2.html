<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Desviar dos Asteroides</title>
  <style>
    body {
      margin: 0;
      background: #000011;
      color: white;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow: hidden;
    }

    canvas {
      display: block;
      margin: 0 auto;
      background: linear-gradient(to bottom, #001122, #000000);
      border: 2px solid #555;
      border-radius: 8px;
      box-shadow: 0 0 20px #0ff;
    }

    #scoreboard {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 1.4rem;
      font-weight: bold;
      text-shadow: 0 0 4px #0ff;
      user-select: none;
    }

    #gameOver {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #ff4444;
      font-size: 2rem;
      text-align: center;
      display: none;
      text-shadow: 0 0 10px #ff0000;
      user-select: none;
    }

    #gameOver p {
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div id="scoreboard">Pontua칞칚o: 0</div>
  <div id="gameOver">
    <p>游눤 GAME OVER 游눤</p>
    <p id="finalScore"></p>
    <p>Pressione <b>R</b> para reiniciar</p>
  </div>

  <canvas id="gameCanvas" width="800" height="600"></canvas>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    const scoreboard = document.getElementById('scoreboard');
    const gameOverDiv = document.getElementById('gameOver');
    const finalScoreP = document.getElementById('finalScore');

    const player = {
      x: canvas.width / 2,
      y: canvas.height - 50,
      width: 40,
      height: 50,
      speed: 7,
      color: '#00ffff',
    };

    let bullets = [];
    let meteors = [];
    let keys = {};
    let score = 0;
    let highScore = localStorage.getItem('highScore') || 0;
    let gameOver = false;
    let meteorSpawnTimer = 0;
    const meteorSpawnInterval = 70; // frames

    function getMeteorHP(radius) {
      return Math.max(1, Math.floor((radius - 10) / 5));
    }

    function drawPlayer() {
      ctx.fillStyle = player.color;
      ctx.beginPath();
      ctx.moveTo(player.x, player.y - player.height / 2);
      ctx.lineTo(player.x - player.width / 2, player.y + player.height / 2);
      ctx.lineTo(player.x + player.width / 2, player.y + player.height / 2);
      ctx.closePath();
      ctx.fill();
      // chama atr치s da nave
      ctx.fillStyle = '#007777';
      ctx.beginPath();
      ctx.moveTo(player.x - 8, player.y + player.height / 2);
      ctx.lineTo(player.x, player.y + player.height / 2 + 10);
      ctx.lineTo(player.x + 8, player.y + player.height / 2);
      ctx.closePath();
      ctx.fill();
    }

    // Desenha balas estilo m칤ssil
    function drawBullets() {
      bullets.forEach(b => {
        ctx.save();
        ctx.translate(b.x, b.y);
        ctx.fillStyle = '#0ff';

        // Corpo do m칤ssil
        ctx.beginPath();
        ctx.rect(-3, 0, 6, 12);
        ctx.fill();

        // Ponta (tri칙ngulo)
        ctx.beginPath();
        ctx.moveTo(0, -6);
        ctx.lineTo(-4, 0);
        ctx.lineTo(4, 0);
        ctx.closePath();
        ctx.fillStyle = '#00ffff';
        ctx.fill();

        // Chamas na base do m칤ssil
        const flameGradient = ctx.createRadialGradient(0, 14, 1, 0, 14, 6);
        flameGradient.addColorStop(0, 'rgba(0,255,255,0.8)');
        flameGradient.addColorStop(1, 'rgba(0,255,255,0)');
        ctx.fillStyle = flameGradient;
        ctx.beginPath();
        ctx.ellipse(0, 14, 5, 8, 0, 0, Math.PI * 2);
        ctx.fill();

        ctx.restore();
      });
    }

    function drawMeteors() {
      meteors.forEach(m => {
        const gradient = ctx.createRadialGradient(m.x, m.y, m.radius * 0.3, m.x, m.y, m.radius);
        gradient.addColorStop(0, '#ffcc33');
        gradient.addColorStop(1, '#cc6600');
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(m.x, m.y, m.radius, 0, Math.PI * 2);
        ctx.fill();

        ctx.fillStyle = '#996600';
        for(let i=0; i<3; i++) {
          let angle = (i * 2 * Math.PI / 3) + (performance.now() / 500);
          let craterX = m.x + Math.cos(angle) * m.radius * 0.5;
          let craterY = m.y + Math.sin(angle) * m.radius * 0.5;
          ctx.beginPath();
          ctx.arc(craterX, craterY, m.radius * 0.15, 0, Math.PI * 2);
          ctx.fill();
        }

        const barWidth = m.radius * 2;
        const barHeight = 6;
        const hpRatio = m.hp / m.maxHp;
        ctx.fillStyle = 'rgba(255, 0, 0, 0.6)';
        ctx.fillRect(m.x - m.radius, m.y - m.radius - 15, barWidth, barHeight);
        ctx.fillStyle = 'lime';
        ctx.fillRect(m.x - m.radius, m.y - m.radius - 15, barWidth * hpRatio, barHeight);
        ctx.strokeStyle = 'black';
        ctx.lineWidth = 1;
        ctx.strokeRect(m.x - m.radius, m.y - m.radius - 15, barWidth, barHeight);
      });
    }

    function update() {
  if(gameOver) return;

  // Movimento do jogador
  if(keys['a'] && player.x - player.width / 2 > 0) {
    player.x -= player.speed;
  }
  if(keys['d'] && player.x + player.width / 2 < canvas.width) {
    player.x += player.speed;
  }

  // Atualizar balas: percorrer de tr치s para frente para evitar bugs ao remover
  for (let i = bullets.length - 1; i >= 0; i--) {
    bullets[i].y -= 10;
    if (bullets[i].y < -10) {
      bullets.splice(i, 1);
    }
  }

  // Atualiza meteoros
  meteors.forEach((m, i) => {
    m.y += m.speed;

    if (
      m.y + m.radius > player.y - player.height / 2 &&
      m.x > player.x - player.width / 2 &&
      m.x < player.x + player.width / 2
    ) {
      endGame();
    }

    // Colis칚o com balas (percorrer balas de tr치s para frente)
    for (let bi = bullets.length - 1; bi >= 0; bi--) {
      let b = bullets[bi];
      let dx = m.x - b.x;
      let dy = m.y - b.y;
      let dist = Math.sqrt(dx * dx + dy * dy);
      if (dist < m.radius) {
        bullets.splice(bi, 1);
        m.hp -= 1;
        if (m.hp <= 0) {
          meteors.splice(i, 1);
          score += 10;
          updateScore();
          break; // meteor destru칤do, sai do loop
        }
      }
    }

    if (m.y - m.radius > canvas.height) {
      meteors.splice(i, 1);
    }
  });

  meteorSpawnTimer++;
  if (meteorSpawnTimer > meteorSpawnInterval) {
    meteorSpawnTimer = 0;
    spawnMeteor();
  }
}

    function spawnMeteor() {
      const radius = 15 + Math.random() * 20;
      const speed = 1 + Math.random() * 2;
      const x = Math.random() * (canvas.width - 2 * radius) + radius;
      const maxHp = getMeteorHP(radius);
      meteors.push({ x, y: -radius, radius, speed, hp: maxHp, maxHp });
    }

    function updateScore() {
      scoreboard.textContent = `Pontua칞칚o: ${score}`;
    }

    function endGame() {
      gameOver = true;
      if(score > highScore) {
        highScore = score;
        localStorage.setItem('highScore', highScore);
      }
      finalScoreP.textContent = `Pontua칞칚o Final: ${score} | Recorde: ${highScore}`;
      gameOverDiv.style.display = 'block';
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawPlayer();
      drawBullets();
      drawMeteors();
    }

    function gameLoop() {
      update();
      draw();
      if(!gameOver) {
        requestAnimationFrame(gameLoop);
      }
    }

    function resetGame() {
      score = 0;
      updateScore();
      bullets = [];
      meteors = [];
      player.x = canvas.width / 2;
      gameOver = false;
      gameOverDiv.style.display = 'none';
      gameLoop();
    }

    window.addEventListener('keydown', e => {
  keys[e.key.toLowerCase()] = true;
  if (e.key === ' ' && !gameOver) {
    bullets.push({
      x: player.x,
      y: player.y - player.height / 2
    });
  }

  if (e.key.toLowerCase() === 'r' && gameOver) {
    resetGame();
  }
});


    window.addEventListener('keyup', e => {
      keys[e.key] = false;
    });

    updateScore();
    gameLoop();
  </script>
</body>
</html>
